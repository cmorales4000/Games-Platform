var htmlProcess = $('<div class="ui-front loader ui-widget-overlay solid-white opacity-60"><div class="ui-widget-overlay"></div><div id="imgOverlay"><img src="/assets/global/img/ajax-loading.gif" /></div></div>'), ajaxSend = function (j, k, a, b, l) { var d = function (a) { a = a && "object" == typeof a; null == a && (a = !1); return a }; if (void 0 == b || null == b) b = ""; var d = function (a) { return a && "object" == typeof a }, f = !1; 0 != $(a).length ? f = !0 : d(a) ? f = !0 : d(document.getElementById(a)) && (a = document.getElementById(a), f = !0); if (!f && void 0 != a && null != a) return alert("[ERROR, URL Er]: " + j + "\n\n[Par\u00e1metros Er]: " + k.toString() + "\n\n[Id Obj. Dest.]: " + a.toString() + "\n\n[Funci\u00f3n Final]: " + b.toString() + '\n\n[Descripci\u00f3n E]: Se hace referencia a un objeto destino "' + a.toString() + '" que no ex\u00edste.'), !1; htmlProcess.appendTo("body"); $("#imgOverlay").css({ position: "absolute", top: $(window).height() / 2, left: $(window).width() / 2 }); $.ajax({ url: j, global: !1, type: "POST", data: k, dataType: "html", async: !0, complete: function (m, n) { htmlProcess.remove(); if ("error" != m.status) { var e = {}, e = document.createElement("div"); e.innerHTML = "&nbsp;" + m.responseText; var g = e.getElementsByTagName("script"); if (0 < g.length) { for (var h = "", c = 0; c < g.length; c++) "ajax" == g[c].id && (h += g[c].innerHTML); for (c = 0; c < g.length; c++) "ajax" == g[c].id && e.removeChild(g[c]); f && $(a).html(e.innerHTML.substring(6, e.innerHTML.length)); try { "" != h && eval(h) } catch (d) { jQuery.isFunction(b) || (b = ""), null == a ? a = "[null]" : void 0 == a && (a = "[undefined]"), alert("[ERROR, URL Er]: " + j + "\n\n[Par\u00e1metros Er]: " + k.toString() + "\n\n[Id Obj. Dest.]: " + a.toString() + "\n\n[Funci\u00f3n Final]: " + b.toString() + "\n\n[C\u00f3digo Fuente]: " + h + "\n\n[Descripci\u00f3n E]: " + d.toString()) } } else f && $(a).html(e.innerHTML.substring(6, e.innerHTML.length)); if (jQuery.isFunction(b)) b(m.responseText, n, m); else try { "" != b && eval(b) } catch (l) { null == a ? a = "[null]" : void 0 == a && (a = "[undefined]"), alert("[ERROR, URL Er]: " + j + "\n\n[Par\u00e1metros Er]: " + k.toString() + "\n\n[Id Obj. Dest.]: " + a.toString() + "\n\n[Funci\u00f3n Final]: " + b.toString() + "\n\n[C\u00f3digo Fuente]: " + b + "\n\n[Descripci\u00f3n E]: " + l.toString()) } } $('[data-toggle="tooltip"]').tooltip(); }, error: function (b, d) { htmlProcess.remove(); jQuery.isFunction(l) ? l(b, d) : (alert(d + "\n" + b.responseText), f && $(a).html(b.responseText)) } }) };
var $overlay = $('<div class="ui-front loader ui-widget-overlay solid-white opacity-60"><div class="ui-widget-overlay"></div><div id="imgOverlayTmp"><img src="/assets/global/img/ajax-loading.gif" /></div></div>');

var bloquearPantalla = function () {
    $overlay.appendTo('body');
    $('#imgOverlayTmp').css({ 'position': 'absolute', 'z-index': 99999999, 'top': ($(window).height() / 2), 'left': ($(window).width() / 2) });
}

var desbloquearPantalla = function () {
    $overlay.remove();
}

var randomString = function (len, charSet) {
    charSet = charSet || 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    var randomString = '';
    for (var i = 0; i < len; i++) {
        var randomPoz = Math.floor(Math.random() * charSet.length);
        randomString += charSet.substring(randomPoz, randomPoz + 1);
    }
    return randomString;
}

var mensajeAlerta = function (mensaje) {
    var capa = randomString(8);
    var $content = $('<div/>', {
        'class': 'modal-content'
    });
    var $modal = $('<div/>', {
        'class': 'modal-dialog modal-sm'
    });
    var $dialog = $('<div/>', {
        'id': capa,
        'class': 'modal fade',
        'tabindex': '-1',
        'aria-hidden': 'true',
        'style': 'top:5%;margin:0 auto !important;'
    });
    $('body').append($dialog.append($modal.append($content)));

    var contenido = '';
    contenido += '<div class="modal-header">';
    contenido += '<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>';
    contenido += '</div>';
    contenido += '<div class="modal-body">' + mensaje + '</div>';
    contenido += '<div class="modal-footer">';
    contenido += '<button type="button" data-dismiss="modal" class="btn blue">';
    contenido += '<span class="button-content">Aceptar</span>';
    contenido += '</button>';
    contenido += '</div>';
    $content.append(contenido);

    $('body').append($dialog);
    $dialog.on('hidden.bs.modal', function (e) { $dialog.remove(); }).modal('show');
}
var mensajeAlerta2 = function (mensaje) {
    var capa = randomString(8);
    var $content = $('<div/>', {
        'class': 'modal-content'
    });
    var $modal = $('<div/>', {
        'class': 'modal-dialog modal-md'
    });
    var $dialog = $('<div/>', {
        'id': capa,
        'class': 'modal fade',
        'tabindex': '-1',
        'aria-hidden': 'true',
        'style': 'top:5%;margin:0 auto !important;'
    });
    $('body').append($dialog.append($modal.append($content)));

    var contenido = '';
    contenido += '<div class="modal-header">';
    contenido += '<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>';
    contenido += '</div>';
    contenido += '<div class="modal-body">' + mensaje + '</div>';
    contenido += '<div class="modal-footer">';
    contenido += '<button type="button" data-dismiss="modal" class="btn blue">';
    contenido += '<span class="button-content">Aceptar</span>';
    contenido += '</button>';
    contenido += '</div>';
    $content.append(contenido);

    $('body').append($dialog);
    $dialog.on('hidden.bs.modal', function (e) { $dialog.remove(); }).modal('show');
}

var mensajeAlertaTop = function (mensaje) {
    var capa = randomString(8);
    $('body').append('<div id="' + capa + '"></div>')
    $('#' + capa).html("<div class='ui-state-error ui-corner-all' style='padding: 0 .7em;'><p style='text-align:justify'><span class='ui-icon ui-icon-alert' style='float: left; margin-right: .3em;'></span><strong></strong>" + mensaje + "</p></div>").dialog({ buttons: { 'Aceptar': function () { $(this).dialog('close'); } }, autoOpen: false, resizable: false, modal: true, width: 'auto', position: ['center', 80], close: function (event, ui) { $(this).remove(); } }).dialog('open').prev('.ui-dialog-titlebar').hide();
}

var mensajeConfirmacion = function (mensaje, funcion) {
    var capa = randomString(8);
    var $content = $('<div/>', {
        'class': 'modal-content'
    });
    var $modal = $('<div/>', {
        'class': 'modal-dialog modal-sm'
    });
    var $dialog = $('<div/>', {
        'id': capa,
        'class': 'modal fade',
        'tabindex': '-1',
        'aria-hidden': 'true',
        'style': 'top:5%;margin:0 auto !important;'
    });
    $('body').append($dialog.append($modal.append($content)));

    var contenido = '';
    contenido += '<div class="modal-header">';
    contenido += '<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>';
    contenido += '</div>';
    contenido += '<div class="modal-body">' + mensaje + '</div>';
    contenido += '<div class="modal-footer">';
    contenido += '<button type="button" data-dismiss="modal" class="btn default">';
    contenido += '<span class="button-content">Cancelar</span>';
    contenido += '</button>';
    contenido += '<button type="button" class="btn blue" onclick="' + eval(funcion) + ';$(\'#' + capa + '\').modal(\'hide\');">';
    contenido += '<span class="button-content">Aceptar</span>';
    contenido += '</button>';
    contenido += '</div>';
    $content.append(contenido);

    $('body').append($dialog);
    $dialog.on('hidden.bs.modal', function (e) { $dialog.remove(); }).modal('show');
}

var jqueryDatepicker = function (maxDate) {
    maxDate = maxDate || "";
    var currentTime = new Date()
    var month = currentTime.getMonth() + 1
    var day = currentTime.getDate()
    var year = currentTime.getFullYear()
    var maxYear = '';
    $('.datePicker').each(function () {
        $(this).datepicker({
            maxDate: maxDate == "" ? "" : "+0d",
            changeMonth: true,
            changeYear: true,
            firstDay: 1,
            showOn: "button",
            buttonImageOnly: true,
            buttonImage: "./../images/calendar.png",
            buttonText: "Calendario",
            dateFormat: "dd/mm/yy",
            dayNamesMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"],
            dayNamesShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sab"],
            monthNamesShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
            monthNames: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
            showButtonPanel: true,
            prevText: "Anterior",
            nextText: "Siguiente",
            closeText: "Cerrar",
            currentText: "Hoy"
        });
        if (maxDate != "") {
            $(this).datepicker("option", "yearRange", "1915:" + year);
        }
    });
}

// Obtenemos el maximo Z-Index
$.maxZIndex = $.fn.maxZIndex = function (opt) {
    /// <summary>
    /// Returns the max zOrder in the document (no parameter)
    /// Sets max zOrder by passing a non-zero number
    /// which gets added to the highest zOrder.
    /// </summary>    
    /// <param name="opt" type="object">
    /// inc: increment value, 
    /// group: selector for zIndex elements to find max for
    /// </param>
    /// <returns type="jQuery" />
    var def = { inc: 10, group: "*" };
    $.extend(def, opt);
    var zmax = 0;
    $(def.group).each(function () {
        var cur = parseInt($(this).css('z-index'));
        zmax = cur > zmax ? cur : zmax;
    });
    if (!this.jquery)
        return zmax;

    return this.each(function () {
        zmax += def.inc;
        $(this).css("z-index", zmax);
    });
}

/* Funcion de ejecucion de ajax, con los parametros ya predefinidos
 * url: url de la pagina hacer el llamado ajax
 * params: params a enviar dentro del llamado ajax
 * capa: capa a renderizar el llamado ajax
 * callback: funcion a ajecutar una vez termine el llamado ajax
 */
var ejecutarAjax = function (url, params, capa, callback) {
    ajaxSend(url, params, capa, function () { eval(callback); });
}

var abrirDialogo = function (url, parametros, callBackFunction, width) {
    width = width || 'modal-md';
    var capa = randomString(8);
    var $content = $('<div/>', {
        'class': 'modal-content'
    });
    var $modal = $('<div/>', {
        'class': 'modal-dialog ' + width
    });
    var $dialog = $('<div/>', {
        'id': capa,
        'class': 'modal fade',
        'tabindex': '-1',
        'aria-hidden': 'true',
        'style': 'top:5%;margin:0 auto !important;',
        'data-keyboard': 'false',
        'data-backdrop': 'static'
    });
    $('body').append($dialog.append($modal.append($content)));

    ajaxSend(
        url
        , parametros
        , null
        , function (data) {
            eval(callBackFunction);
            $content.append(data);
            $dialog.on('hidden.bs.modal', function (e) { $dialog.remove(); }).modal('show');
        }
    );
}

var cerrarDialogo = function (id) {
    var padre = $('#' + id).parent().parent().parent().attr('id');
    $('#' + padre).modal('hide');
}

var formValidar = function (idForm, id, tipo, mensaje, name) {
    var bValidacion = true;
    name = name || '';
    if (tipo != 'checkbox') {
        $('#' + idForm + ' #' + id).removeClass('parsley-error');
        $('#val' + idForm + id).remove();
    }
    switch (tipo) {
        case 'select':
            if ($('#' + idForm + ' #' + id).val() == '-') {
                bValidacion = false;
            }
            break;
        case 'empty':
            if ($('#' + idForm + ' #' + id).val() == '') {
                bValidacion = false;
            }
            break;
        case 'radio':
            var bValTmp = false;
            $('input[name="' + name + '"]').each(function () {
                if ($(this).is(':checked')) {
                    bValTmp = true;
                }
            });
            bValidacion = bValTmp;
            break;
        case 'checkbox':
            var bValTmp = false;
            $('input[name="' + name + '"]').each(function () {
                if ($(this).is(':checked')) {
                    bValTmp = true;
                }
                id = $(this).attr('id');
            });
            $('#' + idForm + ' #' + id).css({ 'border': '' });
            $('#val' + idForm + id).remove();
            bValidacion = bValTmp;
            break;
        case 'email':
            if ($('#' + idForm + ' #' + id).val() == '') {
                bValidacion = false;
            } else if (!validateEmail($('#' + idForm + ' #' + id).val())) {
                bValidacion = false;
            }
            break;
    }
    if (bValidacion == false) {
        //$('#' + idForm + ' #' + id).addClass('parsley-error');
        //$('#' + idForm + ' #' + id).after('<div id="val' + idForm + id + '" style="color:red;">' + mensaje + '</div>');
        $('#' + idForm + ' #' + id).addClass('parsley-error');
        if (tipo == 'checkbox') {
            $('#' + idForm + ' #' + id).parent().parent().after('<div id="val' + idForm + id + '" style="color:red;">' + mensaje + '</div>');
        } else if (tipo != 'radio') {
            $('#' + idForm + ' #' + id).after('<div id="val' + idForm + id + '" style="color:red;">' + mensaje + '</div>');
        }
        else {
            $('#' + idForm + ' #' + id).before('<div id="val' + idForm + id + '" style="color:red;">' + mensaje + '</div>');
        }

    }
    return bValidacion;
}

var validarCheckbox = function (id) {
    var sel = '';
    $('input[name="chkt_' + id + '"]').each(function () {
        if ($(this).is(':checked')) {
            sel += $(this).val() + ',';
        }
    });
    sel = (sel.length > 0 ? sel.substring(0, sel.length - 1) : sel);
    $('#chk_' + id).val(sel);
}

var validarRadios = function (id) {
    var selr = '';
    $('input[name="radio_' + id + '"]').each(function () {
        if ($(this).is(':checked')) {
            selr += $(this).val() + ',';
            //alert('One radio in each group is checked.'+selr);
        }
    });
    selr = (selr.length > 0 ? selr.substring(0, selr.length - 1) : selr);
    $('#radiod_'+ id).val(selr);
}

var formSubmit = function (idForm, url, okCallback, capaId, msgValidacion) {
    //capa = capa || null;
    okCallback = okCallback || function () { };
    msgValidacion = msgValidacion || '';
    var params = {};
    var bValidacion = true;
    $('#' + idForm + ' :input').each(function (key, element) {
        if (String($(this).attr('validar')) != 'undefined') {
            if ($(this).attr('type') == 'radio') {
                if (formValidar(idForm, element.id, $(this).attr('validar').split('|')[0], $(this).attr('validar').split('|')[1], element.name)) {
                    params[element.name] = decodeURIComponent(encodeURIComponent($('input[name="' + element.name + '"]:checked').val()));
                } else {
                    bValidacion = false;
                }
            } else if ($(this).attr('type') == 'checkbox') {
                if (formValidar(idForm, '', $(this).attr('validar').split('|')[0], $(this).attr('validar').split('|')[1], element.name)) {
                    params[element.id] = $('#' + element.id).is(':checked') ? decodeURIComponent(encodeURIComponent(element.value)) : '';
                } else {
                    bValidacion = false;
                }
                //} else if (($(this).is('select')) && ($(this).attr('multiple') != 'undefined')) {
                //    params[element.name] = decodeURIComponent(encodeURIComponent($(this).val()));
                //}
            } else {
                if (formValidar(idForm, element.id, $(this).attr('validar').split('|')[0], $(this).attr('validar').split('|')[1])) {
                    params[element.name] = decodeURIComponent(encodeURIComponent($(this).val()));
                } else {
                    bValidacion = false;
                }
            }
        } else {
            if ($(this).attr('type') == 'radio') {
                params[element.name] = decodeURIComponent(encodeURIComponent($('input[name="' + element.name + '"]:checked').val()));
            } else if ($(this).attr('type') == 'checkbox') {
                /*var chkSel = '';
                $('input:checkbox[name="' + element.name + '"]').each(function () {
                    if ($(this).is(':checked')) {
                        chkSel += '|' + $(this).val();
                    }
                });
                chkSel = chkSel.length > 0 ? chkSel.substring(1) : chkSel;
                params[element.name] = decodeURIComponent(encodeURIComponent(chkSel));*/
                params[element.id] = $('#' + element.id).is(':checked') ? decodeURIComponent(encodeURIComponent(element.value)) : '';
                //} else if (($(this).is('select')) && ($(this).attr('multiple') != 'undefined')) {
                //    params[element.name] = decodeURIComponent(encodeURIComponent($(this).val()));
                //}
            } else {
                params[element.name] = decodeURIComponent(encodeURIComponent($(this).val()));
            }
        }
    });
    if (bValidacion) {
        capaId = capaId || idForm;
        ejecutarAjax(url, params, capaId, okCallback);
    } else if (msgValidacion != '') {
        mensajeAlerta(msgValidacion);
    }
}

var generarExcel = function (idForm, url) {
    var params = {};
    $('#' + idForm + ' :input').each(function (key, element) {
        if ($(this).attr('type') == 'radio') {
            params[element.name] = decodeURIComponent(encodeURIComponent($('input[name="' + element.name + '"]:checked').val()));
        } else if ($(this).attr('type') == 'checkbox') {
            params[element.id] = $('#' + element.id).is(':checked') ? decodeURIComponent(encodeURIComponent(element.value)) : '';
        } else {
            params[element.name] = decodeURIComponent(encodeURIComponent(element.value));
        }
    });

    var formExcel = randomString(8);
    $('body').append('<iframe id="ifrm' + formExcel + '" name="ifrm' + formExcel + '" src="about:blank"  style="width:0px;height:0px;border:0px;margin:0px;padding:0px;" width="0" height="0" scrolling="no" frameborder="0"></iframe>');
    $('body').append('<form id="' + formExcel + '" name="' + formExcel + '" target="ifrm' + formExcel + '" action="' + url + '" method="POST"></form>');
    $.each(params, function (key, value) {
        $('#' + formExcel).append('<input type="hidden" id="' + key + '" name="' + key + '" value="' + value + '" />');
    });
    $('#' + formExcel).submit();
    setTimeout(function () { $('#' + formExcel).remove(); $('#ifrm' + formExcel).remove(); }, 30000);
}

var validateEmail = function ($email) {
    //var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
    //var emailReg = /(^[0-9a-zA-Z]+(?:[._-]*[0-9a-zA-Z]+)*)@([0-9a-zA-Z]+(?:[._-][0-9a-zA-Z]+)*\.[0-9a-zA-Z]{2,10})$/;
    var emailReg = /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i
    if (!emailReg.test($email)) {
        return false;
    } else {
        return true;
    }
}

var cargarCkeditor = function (identificador, alto, empresa) {
    CKEDITOR.replace(identificador, {
        language: 'es',
        height: alto,
        toolbar: [
            ['Source', '-', 'NewPage', 'Preview', '-', 'Templates'],
            ['Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo'],
            ['Find', 'Replace', '-', 'SelectAll'],
            ['Bold', 'Italic', 'Underline', 'Strike', 'Subscript', 'Superscript', '-', 'RemoveFormat'],
            ['NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock'],
            ['Link', 'Unlink'],
            ['Image', 'Table', 'Iframe', 'youtube', 'SpecialChar'],
            ['Styles', 'Format', 'Font', 'FontSize'],
            ['TextColor', 'BGColor']
        ],
        skin: 'moonocolor',
        extraPlugins: 'youtube',
        filebrowserBrowseUrl: '/FileManager/Explorer.aspx?id=/Files/' + empresa + '/Files'
    });
}

var cargarCkeditorMarketPlace = function (identificador, alto, empresa) {
    CKEDITOR.replace(identificador, {
        language: 'es',
        height: alto,
        toolbar: [
            ['Source', '-', 'NewPage', 'Preview', '-', 'Templates'],
            ['Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo'],
            ['Find', 'Replace', '-', 'SelectAll'],
            ['Bold', 'Italic', 'Underline', 'Strike', 'Subscript', 'Superscript', '-', 'RemoveFormat'],
            ['NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock'],
            ['Link', 'Unlink'],
            ['Image', 'Table', 'Iframe', 'youtube', 'SpecialChar'],
            ['Styles', 'Format', 'Font', 'FontSize'],
            ['TextColor', 'BGColor']
        ],
        skin: 'moonocolor',
        extraPlugins: 'youtube',
        filebrowserBrowseUrl: '/FileManager/Explorer.aspx?id=/Files/' + empresa + '/MarketPlace'
    });
}

var padLeft = function (nr, n, str) {
    return Array(n - String(nr).length + 1).join(str || '0') + nr;
}

//var inputs = [
//    { 'fileQueueID':'identificador' ,'id': 'dvFileupload', 'hiddenInput': 'hdnFile', 'divRender': 'dvRenderFile', 'fileExt': '*.png;*.jpg;*.gif;*.zip;*.rar;*.doc;*.docx;*.xls;*.xlsx', 'fileDesc': 'Selecionar Archivo', 'btnText': 'Buscar', 'width': 80 }
//    { 'id': 'dvThumbnail', 'fileExt': '*.jpg;*.png;*.gif', 'fileDesc': 'Imagenes', 'btnText': 'Buscar', 'width': 80 },
//    { 'id': 'dvPlantilla', 'fileExt': '*.zip', 'fileDesc': 'Archivos Comprimidos', 'btnText': 'Buscar', 'width': 80 }
//];
//configUploadify(inputs);
var configUploadifyGeneral = function (jInputs) {
    $.each(jInputs, function (i, item) {
        $('#' + item.id).fileupload({
            url: '/UploadHandler.ashx',
            formData: { 'fileQueueID': item.fileQueueID },
            maxFileSize: item.maxFile, // Maximum File Size in Bytes - 5 MB
            //minFileSize: 100000, // Minimum File Size in Bytes - 100 KB
            dataType: 'json',
            add: function (e, data) {
                var uploadErrors = [];
                var acceptFileTypes = item.fileExt;
                if (data.originalFiles[0]['type'].length && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('No es un tipo de archivo aceptado');
                }
                if (data.originalFiles[0]['size'].length && data.originalFiles[0]['size'] > 5000000) {
                    uploadErrors.push('El tamaño del archivo es demasiado grande');
                }
                if (uploadErrors.length > 0) {
                    mensajeAlerta(uploadErrors.join("\n"));
                } else {
                    data.submit();
                    //$('#' + item.id).fileupload('disable');
                }
            },
            done: function (e, data) {
                if (data.result.rta == 'OK') {
                    var elementRender = '<div class="hijo-igual" style="display:inline-block;">';
                    if ((data.result.filetype == 'png') || (data.result.filetype == 'jpg') || (data.result.filetype == 'gif')) {
                        elementRender += '<img src="' + data.result.dirUpload.replace("../", "/") + data.result.filename + '" style="max-heigth:70px; max-width:200px" />';
                        $('#' + item.hiddenInput).val(data.result.filename);
                    }
                    else {
                        elementRender += 'Archivo: <b>' + data.result.filenameOri + '</b> subido correctamente';
                        $('#' + item.hiddenInput).val(data.result.filename);
                    }
                    elementRender += '<a href="javascript:;" class="badge badge-danger" style="position:absolute; left:15px;" onclick="$(\'#' + item.divRender + '\').html(\'\');$(\'#' + item.hiddenInput + '\').val(\'\');"><b>X</b></a>';
                    elementRender += '</div>';
                    $('#' + item.divRender).html(elementRender);

                    setTimeout(function () {
                        $('#' + item.progressId + ' .progress-bar').css(
                            'width',
                            '0%'
                        );
                    }, 1000);
                } else if (data.result.rta == 'NOT') {
                    mensajeAlerta('Se presentaron incovenientes al momento de subir el archivo.');
                } else if (data.result.rta == 'ERR') {
                    mensajeAlerta('Se genero una exepción. Error: ' + data.result.msgErr);
                }
            },
            progressall: function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('#' + item.progressId + ' .progress-bar').css(
                    'width',
                    progress + '%'
                );
            }
        }).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled');
    });
}

var fileCount = 0;
var configUploadifyGeneralMulti = function (jInputs) {
    $.each(jInputs, function (i, item) {
        $('#' + item.id).fileupload({
            url: '/UploadHandler.ashx',
            formData: { 'fileQueueID': item.fileQueueID },
            maxFileSize: item.maxFile, // Maximum File Size in Bytes - 5 MB
            //minFileSize: 100000, // Minimum File Size in Bytes - 100 KB
            dataType: 'json',
            add: function (e, data) {
                var uploadErrors = [];
                var acceptFileTypes = item.fileExt;
                if (data.originalFiles[0]['type'].length && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('No es un tipo de archivo aceptado');
                }
                if (data.originalFiles[0]['size'].length && data.originalFiles[0]['size'] > 5000000) {
                    uploadErrors.push('El tamaño del archivo es demasiado grande');
                }
                if (uploadErrors.length > 0) {
                    mensajeAlerta(uploadErrors.join("\n"));
                } else {
                    data.submit();
                    //$('#' + item.id).fileupload('disable');
                }
            },
            done: function (e, data) {
                if (data.result.rta == 'OK') {
                    var capa = randomString(8);
                    var $content = $('<div/>', {
                        'id': capa,
                        'style': 'display:inline-block;',
                        'class': 'hijo-igual col-md-3 col-sm-4 mix'
                    });
                    var sContent = '';
                    if ((data.result.filetype == 'png') || (data.result.filetype == 'jpg') || (data.result.filetype == 'gif')) {
                        /*Para este caso se debe incluir los plugin del mixitup, y el fancybox version 2*/
                        //sContent += '<img src="' + data.result.dirUpload.replace("../", "/") + data.result.filename + '" alt="" style="max-heigth:70px; max-width:200px" />';
                        //sContent += '<a href="javascript:;" class="badge badge-danger" style="position:absolute; left:15px;" onclick="$(\'#' + capa + '\').remove();"><b>X</b></a>';


                        /*Para este caso se debe incluir los plugin del mixitup, y el fancybox version 2*/
                        sContent += '<div class="mix-inner">';
                        sContent += '<img class="img-responsive" src="' + data.result.dirUpload.replace("../", "/") + data.result.filename + '" alt="" />';
                        sContent += '<div class="mix-details">';
                        sContent += '<h4>' + data.result.filenameOri + '</h4>';
                        sContent += '<a class="mix-link" href="javascript:;" onclick="javascript:cargarFormImagen(' + fileCount + ');">';
                        sContent += '<i class="fa fa-edit"></i>';
                        sContent += '</a>';
                        sContent += '<a class="mix-preview" href="javascript:;" onclick="$(\'#' + capa + '\').remove();">';
                        sContent += '<i class="fa fa-trash-o"></i>';
                        sContent += '</a>';
                        sContent += '<div style="margin-top:57px;"><a class="mix-preview fancybox-button" href="' + data.result.dirUpload + data.result.filename + '" data-rel="fancybox-button" title="' + data.result.filenameOri + '">';
                        sContent += '<i class="fa fa-search"></i>';
                        sContent += '</a></div>';
                        sContent += '</div>';
                        sContent += '</div>';
                    }
                    else {
                        sContent += 'Archivo: <b>' + data.result.filenameOri + '</b> subido correctamente';
                        sContent += '<br /><a href="javascript:;" onclick="$(\'#' + capa + '\').remove();">Eliminar</a>';
                    }
                    sContent += '<input type="hidden" id="inputFile_' + fileCount + '"  name="inputFile_' + fileCount + '" value="' + data.result.filename + '" />';
                    sContent += '<input type="hidden" id="inputFileName_' + fileCount + '"  name="inputFileName_' + fileCount + '" value="' + data.result.filenameOri + '" />';
                    sContent += '<input type="hidden" id="inputFileDesc_' + fileCount + '"  name="inputFileDesc_' + fileCount + '" value="" />';
                    fileCount++;

                    $('#' + item.renderFile).append($content.html(sContent));
                    setTimeout(function () {
                        $('#' + item.progressId + ' .progress-bar').css(
                            'width',
                            '0%'
                        );
                    }, 1000);
                    if ((data.result.filetype == 'png') || (data.result.filetype == 'jpg') || (data.result.filetype == 'gif')) {
                        reloadPluginGaleria();
                    }
                } else if (data.result.rta == 'NOT') {
                    mensajeAlerta('Se presentaron incovenientes al momento de subir el archivo.');
                } else if (data.result.rta == 'ERR') {
                    mensajeAlerta('Se genero una exepción. Error: ' + data.result.msgErr);
                }
            },
            progressall: function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('#' + item.progressId + ' .progress-bar').css(
                    'width',
                    progress + '%'
                );
            }
        }).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled');
    });
}

var reloadPluginGaleria = function () {
    setTimeout(function () { $('.mix-grid').mixitup(); initFancybox(); }, 200);
}

var initFancybox = function () {
    if (!jQuery.fancybox) {
        return;
    }
    if (jQuery(".fancybox-button").size() > 0) {
        jQuery(".fancybox-button").fancybox({
            groupAttr: 'data-rel',
            prevEffect: 'none',
            nextEffect: 'none',
            closeBtn: true,
            helpers: {
                overlay: {
                    css: { 'z-index': $.maxZIndex() + 1 },
                },
                title: {
                    type: 'inside'
                }
            }
        });
    }
}

function soloNum(evt) {
    evt = (evt) ? evt : window.event;
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
    }
    return true;
}

var slug = function (str) {
    str = replaceAll(str, 'á', 'a');
    str = replaceAll(str, 'é', 'e');
    str = replaceAll(str, 'í', 'i');
    str = replaceAll(str, 'ó', 'o');
    str = replaceAll(str, 'ú', 'u');
    str = replaceAll(str, 'ñ', 'n');
    var $slug = '';
    var trimmed = $.trim(str);
    $slug = trimmed.replace(/[^@0-9A-Za-z]/gi, '-').
        replace(/-+/g, '').
        replace(/^-|-$/g, '');
    return $slug.toLowerCase();
}

var replaceAll = function (str, find, replace) {
    return str.replace(new RegExp(find, 'g'), replace);
}
